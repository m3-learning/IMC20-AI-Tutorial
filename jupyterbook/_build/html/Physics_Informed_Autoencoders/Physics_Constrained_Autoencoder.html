

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Physics Constrained Autoencoders &#8212; Artificial Intelligence Methods for Microscopy Analysis and Knowledge Extraction</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Physics_Informed_Autoencoders/Physics_Constrained_Autoencoder';</script>
    <link rel="shortcut icon" href="../_static/Drexel_M3_Logo-01.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/Drexel_M3_Logo-01.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/Drexel_M3_Logo-01.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    title: “Artificial Intelligence Methods for Microscopy Analysis and Knowledge Extraction”
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Unsupervised_Learning_with_AEs/Unsupervised_Learning_with_Autoencoders.html">1. Unsupervised Spectral Unmixing with Autoencoders</a></li>


</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/m3-learning/IMC20-AI-Tutorial/main?urlpath=tree/notebooks/Physics_Informed_Autoencoders/Physics_Constrained_Autoencoder.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/m3-learning/IMC20-AI-Tutorial/blob/main/notebooks/Physics_Informed_Autoencoders/Physics_Constrained_Autoencoder.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/m3-learning/IMC20-AI-Tutorial" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/m3-learning/IMC20-AI-Tutorial/issues/new?title=Issue%20on%20page%20%2FPhysics_Informed_Autoencoders/Physics_Constrained_Autoencoder.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Physics_Informed_Autoencoders/Physics_Constrained_Autoencoder.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Physics Constrained Autoencoders</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-packages">Imports Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-some-data-based-on-the-image">Generating some data based on the image</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-a-non-linear-function">Define a non-linear function</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-examples">Visualize examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recurrent-neural-network-autoencoders">Recurrent Neural Network Autoencoders</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#builds-the-autoencoder">Builds the autoencoder</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#builds-the-dataloader">Builds the dataloader</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-the-reconstruction">Visualize the reconstruction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-validation-data">Generating Validation Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loads-and-image-of-my-dog-nala">Loads and image of my dog Nala</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#displays-the-image">Displays the image</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generates-the-data-from-rgb-sampling">Generates the data from RGB sampling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-the-learned-results">Visualize the learned results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-try-a-bigger-model">Let’s try a bigger model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#builds-the-model">Builds the model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training">Training</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Visualize the reconstruction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Visualize the learned results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#physics-constrained-neural-network">Physics constrained neural network</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-the-model">Building the model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataloader">Dataloader</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Training</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validation">Validation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#try-with-a-better-optimizer-adahessian">Try with a better optimizer AdaHessian</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Builds the model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Dataloader</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Training</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization">Visualization</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="physics-constrained-autoencoders">
<h1>Physics Constrained Autoencoders<a class="headerlink" href="#physics-constrained-autoencoders" title="Permalink to this heading">#</a></h1>
<p>By Mary Ye<span class="math notranslate nohighlight">\(^1\)</span>, Joshua C. Agar<span class="math notranslate nohighlight">\(^2\)</span></p>
<p><span class="math notranslate nohighlight">\(^1\)</span> Department of Computer science and Engineering, Lehigh University
<span class="math notranslate nohighlight">\(^2\)</span> Department of Mechanical Engineering and Mechanics, Drexel University</p>
<ul class="simple">
<li><p>There are many times where you want to fit spectroscopic data to a model</p></li>
</ul>
<ul class="simple">
<li><p>Classical fitting methods can be used but break down:</p>
<ul>
<li><p>When data is noisy</p></li>
<li><p>There are multiple candidate models</p></li>
<li><p>Data is high velocity</p></li>
<li><p>Data is noisy</p></li>
</ul>
</li>
</ul>
<section id="imports-packages">
<h2>Imports Packages<a class="headerlink" href="#imports-packages" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>m3_learning
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: m3_learning in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (0.0.17)
Collecting autopep8==2.0.0 (from m3_learning)
  Using cached autopep8-2.0.0-py2.py3-none-any.whl (45 kB)
Collecting BGlib==0.0.3 (from m3_learning)
  Using cached BGlib-0.0.3-py2.py3-none-any.whl (189 kB)
Collecting gdown==4.5.3 (from m3_learning)
  Using cached gdown-4.5.3-py3-none-any.whl (14 kB)
Requirement already satisfied: h5py==3.7.0 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (3.7.0)
Collecting imageio==2.22.3 (from m3_learning)
  Using cached imageio-2.22.3-py3-none-any.whl (3.4 MB)
Collecting jupyter==1.0.0 (from m3_learning)
  Using cached jupyter-1.0.0-py2.py3-none-any.whl (2.7 kB)
Collecting matplotlib==3.6.2 (from m3_learning)
  Using cached matplotlib-3.6.2-cp310-cp310-win_amd64.whl (7.2 MB)
Collecting numpy==1.23.4 (from m3_learning)
  Using cached numpy-1.23.4-cp310-cp310-win_amd64.whl (14.6 MB)
Collecting pandas==1.5.1 (from m3_learning)
  Using cached pandas-1.5.1-cp310-cp310-win_amd64.whl (10.4 MB)
Collecting Pillow==9.3.0 (from m3_learning)
  Using cached Pillow-9.3.0-cp310-cp310-win_amd64.whl (2.5 MB)
Collecting protobuf==3.19.6 (from m3_learning)
  Using cached protobuf-3.19.6-cp310-cp310-win_amd64.whl (895 kB)
Collecting psutil==5.9.3 (from m3_learning)
  Using cached psutil-5.9.3-cp310-cp310-win_amd64.whl (247 kB)
Requirement already satisfied: pure-eval==0.2.2 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (0.2.2)
Requirement already satisfied: pyasn1==0.4.8 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (0.4.8)
Requirement already satisfied: pyasn1-modules==0.2.8 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (0.2.8)
Collecting pycodestyle==2.9.1 (from m3_learning)
  Using cached pycodestyle-2.9.1-py2.py3-none-any.whl (41 kB)
Collecting pycparser==2.21 (from m3_learning)
  Using cached pycparser-2.21-py2.py3-none-any.whl (118 kB)
Collecting pycroscopy==0.62.1 (from m3_learning)
  Downloading pycroscopy-0.62.1-py2.py3-none-any.whl (48 kB)
     ---------------------------------------- 48.2/48.2 kB 1.2 MB/s eta 0:00:00
Collecting Pygments==2.13.0 (from m3_learning)
  Using cached Pygments-2.13.0-py3-none-any.whl (1.1 MB)
Requirement already satisfied: pyparsing==3.0.9 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (3.0.9)
Collecting pyNSID==0.0.7 (from m3_learning)
  Downloading pyNSID-0.0.7-py2.py3-none-any.whl (12 kB)
Collecting pyrsistent==0.19.2 (from m3_learning)
  Using cached pyrsistent-0.19.2-cp310-cp310-win_amd64.whl (62 kB)
Collecting PySocks==1.7.1 (from m3_learning)
  Using cached PySocks-1.7.1-py3-none-any.whl (16 kB)
Requirement already satisfied: python-dateutil==2.8.2 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (2.8.2)
Collecting pytz==2022.6 (from m3_learning)
  Using cached pytz-2022.6-py2.py3-none-any.whl (498 kB)
Collecting pyUSID==0.0.10 (from m3_learning)
  Using cached pyUSID-0.0.10-py2.py3-none-any.whl (66 kB)
Requirement already satisfied: scikit-image==0.19.3 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (0.19.3)
Collecting scikit-learn==1.1.3 (from m3_learning)
  Using cached scikit_learn-1.1.3-cp310-cp310-win_amd64.whl (7.5 MB)
Collecting scipy==1.9.3 (from m3_learning)
  Using cached scipy-1.9.3-cp310-cp310-win_amd64.whl (40.1 MB)
Collecting seaborn==0.12.1 (from m3_learning)
  Using cached seaborn-0.12.1-py3-none-any.whl (288 kB)
Collecting sidpy==0.11 (from m3_learning)
  Using cached sidpy-0.11-py2.py3-none-any.whl (96 kB)
Requirement already satisfied: six==1.16.0 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (1.16.0)
Requirement already satisfied: sklearn==0.0 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (0.0)
INFO: pip is looking at multiple versions of m3-learning to determine which version is compatible with other requirements. This could take a while.
Collecting m3_learning
  Downloading m3_learning-0.0.16-py3-none-any.whl (61 kB)
     ---------------------------------------- 61.1/61.1 kB 3.2 MB/s eta 0:00:00
Collecting absl-py==1.3.0 (from m3_learning)
  Using cached absl_py-1.3.0-py3-none-any.whl (124 kB)
Collecting anyio==3.6.2 (from m3_learning)
  Using cached anyio-3.6.2-py3-none-any.whl (80 kB)
Collecting argon2-cffi==21.3.0 (from m3_learning)
  Using cached argon2_cffi-21.3.0-py3-none-any.whl (14 kB)
Collecting argon2-cffi-bindings==21.2.0 (from m3_learning)
  Using cached argon2_cffi_bindings-21.2.0-cp36-abi3-win_amd64.whl (30 kB)
Collecting asttokens==2.1.0 (from m3_learning)
  Using cached asttokens-2.1.0-py2.py3-none-any.whl (26 kB)
Requirement already satisfied: astunparse==1.6.3 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (1.6.3)
Collecting attrs==22.1.0 (from m3_learning)
  Using cached attrs-22.1.0-py2.py3-none-any.whl (58 kB)
Requirement already satisfied: backcall==0.2.0 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (0.2.0)
Collecting beautifulsoup4==4.11.1 (from m3_learning)
  Using cached beautifulsoup4-4.11.1-py3-none-any.whl (128 kB)
Collecting bleach==5.0.1 (from m3_learning)
  Using cached bleach-5.0.1-py3-none-any.whl (160 kB)
Collecting cachetools==5.2.0 (from m3_learning)
  Using cached cachetools-5.2.0-py3-none-any.whl (9.3 kB)
Collecting certifi==2022.9.24 (from m3_learning)
  Using cached certifi-2022.9.24-py3-none-any.whl (161 kB)
Collecting cffi==1.15.1 (from m3_learning)
  Using cached cffi-1.15.1-cp310-cp310-win_amd64.whl (179 kB)
Collecting charset-normalizer==2.1.1 (from m3_learning)
  Using cached charset_normalizer-2.1.1-py3-none-any.whl (39 kB)
Requirement already satisfied: click==8.1.3 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (8.1.3)
Requirement already satisfied: cloudpickle==2.2.0 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (2.2.0)
Requirement already satisfied: colorama==0.4.6 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (0.4.6)
Collecting contourpy==1.0.6 (from m3_learning)
  Using cached contourpy-1.0.6-cp310-cp310-win_amd64.whl (163 kB)
Requirement already satisfied: cycler==0.11.0 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (0.11.0)
Requirement already satisfied: cytoolz==0.12.0 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (0.12.0)
Requirement already satisfied: dask==2022.10.2 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (2022.10.2)
Collecting debugpy==1.6.3 (from m3_learning)
  Using cached debugpy-1.6.3-cp310-cp310-win_amd64.whl (4.6 MB)
Requirement already satisfied: decorator==5.1.1 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (5.1.1)
Collecting defusedxml==0.7.1 (from m3_learning)
  Using cached defusedxml-0.7.1-py2.py3-none-any.whl (25 kB)
Requirement already satisfied: distributed==2022.10.2 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (2022.10.2)
Requirement already satisfied: entrypoints==0.4 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (0.4)
Requirement already satisfied: executing==1.2.0 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (1.2.0)
Collecting fastjsonschema==2.16.2 (from m3_learning)
  Using cached fastjsonschema-2.16.2-py3-none-any.whl (22 kB)
Collecting filelock==3.8.0 (from m3_learning)
  Using cached filelock-3.8.0-py3-none-any.whl (10 kB)
Collecting flatbuffers==22.10.26 (from m3_learning)
  Using cached flatbuffers-22.10.26-py2.py3-none-any.whl (26 kB)
Collecting fonttools==4.38.0 (from m3_learning)
  Using cached fonttools-4.38.0-py3-none-any.whl (965 kB)
Requirement already satisfied: fsspec==2022.10.0 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (2022.10.0)
Requirement already satisfied: gast==0.4.0 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (0.4.0)
Collecting google-auth==2.14.0 (from m3_learning)
  Using cached google_auth-2.14.0-py2.py3-none-any.whl (175 kB)
Collecting google-auth-oauthlib==0.4.6 (from m3_learning)
  Using cached google_auth_oauthlib-0.4.6-py2.py3-none-any.whl (18 kB)
Requirement already satisfied: google-pasta==0.2.0 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (0.2.0)
Collecting grpcio==1.50.0 (from m3_learning)
  Using cached grpcio-1.50.0-cp310-cp310-win_amd64.whl (3.6 MB)
Collecting HeapDict==1.0.1 (from m3_learning)
  Using cached HeapDict-1.0.1-py3-none-any.whl (3.9 kB)
Requirement already satisfied: idna==3.4 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (3.4)
Requirement already satisfied: ipyfilechooser==0.6.0 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (0.6.0)
Collecting ipykernel==6.17.0 (from m3_learning)
  Using cached ipykernel-6.17.0-py3-none-any.whl (138 kB)
Collecting ipython==8.6.0 (from m3_learning)
  Using cached ipython-8.6.0-py3-none-any.whl (761 kB)
Collecting ipython-genutils==0.2.0 (from m3_learning)
  Using cached ipython_genutils-0.2.0-py2.py3-none-any.whl (26 kB)
Collecting ipywidgets==8.0.2 (from m3_learning)
  Using cached ipywidgets-8.0.2-py3-none-any.whl (134 kB)
Collecting jedi==0.18.1 (from m3_learning)
  Using cached jedi-0.18.1-py2.py3-none-any.whl (1.6 MB)
Requirement already satisfied: Jinja2==3.1.2 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (3.1.2)
Collecting joblib==1.2.0 (from m3_learning)
  Using cached joblib-1.2.0-py3-none-any.whl (297 kB)
Collecting jsonschema==4.17.0 (from m3_learning)
  Using cached jsonschema-4.17.0-py3-none-any.whl (83 kB)
Requirement already satisfied: jupyter-client==7.3.4 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (7.3.4)
Collecting jupyter-console==6.4.4 (from m3_learning)
  Using cached jupyter_console-6.4.4-py3-none-any.whl (22 kB)
Collecting jupyter-server==1.21.0 (from m3_learning)
  Using cached jupyter_server-1.21.0-py3-none-any.whl (346 kB)
Collecting jupyter-core==4.11.2 (from m3_learning)
  Using cached jupyter_core-4.11.2-py3-none-any.whl (88 kB)
Collecting jupyterlab-pygments==0.2.2 (from m3_learning)
  Using cached jupyterlab_pygments-0.2.2-py2.py3-none-any.whl (21 kB)
Collecting jupyterlab-widgets==3.0.3 (from m3_learning)
  Using cached jupyterlab_widgets-3.0.3-py3-none-any.whl (384 kB)
Collecting keras==2.10.0 (from m3_learning)
  Using cached keras-2.10.0-py2.py3-none-any.whl (1.7 MB)
Requirement already satisfied: Keras-Preprocessing==1.1.2 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (1.1.2)
Requirement already satisfied: kiwisolver==1.4.4 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (1.4.4)
Collecting libclang==14.0.6 (from m3_learning)
  Using cached libclang-14.0.6-py2.py3-none-win_amd64.whl (14.2 MB)
Requirement already satisfied: locket==1.0.0 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (1.0.0)
Requirement already satisfied: Markdown==3.4.1 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (3.4.1)
Collecting MarkupSafe==2.1.1 (from m3_learning)
  Using cached MarkupSafe-2.1.1-cp310-cp310-win_amd64.whl (17 kB)
Requirement already satisfied: matplotlib-inline==0.1.6 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (0.1.6)
Collecting mistune==2.0.4 (from m3_learning)
  Using cached mistune-2.0.4-py2.py3-none-any.whl (24 kB)
Collecting msgpack==1.0.4 (from m3_learning)
  Using cached msgpack-1.0.4-cp310-cp310-win_amd64.whl (61 kB)
Collecting nbclassic==0.4.8 (from m3_learning)
  Using cached nbclassic-0.4.8-py3-none-any.whl (9.8 MB)
Collecting nbclient==0.7.0 (from m3_learning)
  Using cached nbclient-0.7.0-py3-none-any.whl (71 kB)
Collecting nbconvert==7.2.3 (from m3_learning)
  Using cached nbconvert-7.2.3-py3-none-any.whl (273 kB)
Collecting nbformat==5.7.0 (from m3_learning)
  Using cached nbformat-5.7.0-py3-none-any.whl (77 kB)
Requirement already satisfied: nest-asyncio==1.5.6 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (1.5.6)
Collecting networkx==2.8.8 (from m3_learning)
  Using cached networkx-2.8.8-py3-none-any.whl (2.0 MB)
Collecting notebook==6.5.2 (from m3_learning)
  Using cached notebook-6.5.2-py3-none-any.whl (439 kB)
Collecting notebook-shim==0.2.2 (from m3_learning)
  Using cached notebook_shim-0.2.2-py3-none-any.whl (13 kB)
Requirement already satisfied: numpy-groupies==0.9.7 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (0.9.7)
Requirement already satisfied: oauthlib==3.2.2 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (3.2.2)
Requirement already satisfied: opt-einsum==3.3.0 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (3.3.0)
Collecting packaging==21.3 (from m3_learning)
  Using cached packaging-21.3-py3-none-any.whl (40 kB)
Collecting pandocfilters==1.5.0 (from m3_learning)
  Using cached pandocfilters-1.5.0-py2.py3-none-any.whl (8.7 kB)
Requirement already satisfied: parso==0.8.3 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (0.8.3)
Requirement already satisfied: partd==1.3.0 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (1.3.0)
Requirement already satisfied: pickleshare==0.7.5 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (0.7.5)
Collecting prometheus-client==0.15.0 (from m3_learning)
  Using cached prometheus_client-0.15.0-py3-none-any.whl (60 kB)
Collecting prompt-toolkit==3.0.31 (from m3_learning)
  Using cached prompt_toolkit-3.0.31-py3-none-any.whl (382 kB)
Requirement already satisfied: PyWavelets==1.4.1 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (1.4.1)
Collecting PyYAML==6.0 (from m3_learning)
  Using cached PyYAML-6.0-cp310-cp310-win_amd64.whl (151 kB)
Collecting pyzmq==24.0.1 (from m3_learning)
  Using cached pyzmq-24.0.1-cp310-cp310-win_amd64.whl (992 kB)
Collecting qtconsole==5.4.0 (from m3_learning)
  Using cached qtconsole-5.4.0-py3-none-any.whl (121 kB)
Collecting QtPy==2.2.1 (from m3_learning)
  Using cached QtPy-2.2.1-py3-none-any.whl (82 kB)
Collecting requests==2.28.1 (from m3_learning)
  Using cached requests-2.28.1-py3-none-any.whl (62 kB)
Requirement already satisfied: requests-oauthlib==1.3.1 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (1.3.1)
Requirement already satisfied: rsa==4.9 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (4.9)
Collecting Send2Trash==1.8.0 (from m3_learning)
  Using cached Send2Trash-1.8.0-py3-none-any.whl (18 kB)
Collecting sniffio==1.3.0 (from m3_learning)
  Using cached sniffio-1.3.0-py3-none-any.whl (10 kB)
Requirement already satisfied: sortedcontainers==2.4.0 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (2.4.0)
Collecting soupsieve==2.3.2.post1 (from m3_learning)
  Using cached soupsieve-2.3.2.post1-py3-none-any.whl (37 kB)
Collecting stack-data==0.6.0 (from m3_learning)
  Using cached stack_data-0.6.0-py3-none-any.whl (24 kB)
Requirement already satisfied: tblib==1.7.0 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (1.7.0)
Collecting tensorboard==2.10.1 (from m3_learning)
  Using cached tensorboard-2.10.1-py3-none-any.whl (5.9 MB)
Collecting tensorboard-data-server==0.6.1 (from m3_learning)
  Using cached tensorboard_data_server-0.6.1-py3-none-any.whl (2.4 kB)
Collecting tensorboard-plugin-wit==1.8.1 (from m3_learning)
  Using cached tensorboard_plugin_wit-1.8.1-py3-none-any.whl (781 kB)
Collecting tensorflow==2.10.0 (from m3_learning)
  Using cached tensorflow-2.10.0-cp310-cp310-win_amd64.whl (455.9 MB)
Collecting tensorflow-estimator==2.10.0 (from m3_learning)
  Using cached tensorflow_estimator-2.10.0-py2.py3-none-any.whl (438 kB)
Collecting tensorflow-gpu==2.10.0 (from m3_learning)
  Using cached tensorflow_gpu-2.10.0-cp310-cp310-win_amd64.whl (455.9 MB)
Collecting tensorflow-io-gcs-filesystem==0.27.0 (from m3_learning)
  Using cached tensorflow_io_gcs_filesystem-0.27.0-cp310-cp310-win_amd64.whl (1.5 MB)
Collecting termcolor==2.1.0 (from m3_learning)
  Using cached termcolor-2.1.0-py3-none-any.whl (5.8 kB)
Collecting terminado==0.17.0 (from m3_learning)
  Using cached terminado-0.17.0-py3-none-any.whl (16 kB)
Collecting threadpoolctl==3.1.0 (from m3_learning)
  Using cached threadpoolctl-3.1.0-py3-none-any.whl (14 kB)
Collecting tifffile==2022.10.10 (from m3_learning)
  Using cached tifffile-2022.10.10-py3-none-any.whl (210 kB)
Collecting tinycss2==1.2.1 (from m3_learning)
  Using cached tinycss2-1.2.1-py3-none-any.whl (21 kB)
Collecting tomli==2.0.1 (from m3_learning)
  Using cached tomli-2.0.1-py3-none-any.whl (12 kB)
Requirement already satisfied: toolz==0.12.0 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (0.12.0)
Collecting torch==1.13.0 (from m3_learning)
  Using cached torch-1.13.0-cp310-cp310-win_amd64.whl (167.3 MB)
Collecting torchvision==0.14.0 (from m3_learning)
  Using cached torchvision-0.14.0-cp310-cp310-win_amd64.whl (1.1 MB)
Requirement already satisfied: tornado==6.1 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (6.1)
Collecting tqdm==4.64.1 (from m3_learning)
  Using cached tqdm-4.64.1-py2.py3-none-any.whl (78 kB)
Collecting traitlets==5.5.0 (from m3_learning)
  Using cached traitlets-5.5.0-py3-none-any.whl (107 kB)
Collecting types-requests==2.28.11.2 (from m3_learning)
  Using cached types_requests-2.28.11.2-py3-none-any.whl (14 kB)
Collecting types-urllib3==1.26.25.1 (from m3_learning)
  Using cached types_urllib3-1.26.25.1-py3-none-any.whl (14 kB)
Collecting typing-extensions==4.4.0 (from m3_learning)
  Using cached typing_extensions-4.4.0-py3-none-any.whl (26 kB)
Collecting urllib3==1.26.12 (from m3_learning)
  Using cached urllib3-1.26.12-py2.py3-none-any.whl (140 kB)
Collecting wcwidth==0.2.5 (from m3_learning)
  Using cached wcwidth-0.2.5-py2.py3-none-any.whl (30 kB)
Collecting webencodings==0.5.1 (from m3_learning)
  Using cached webencodings-0.5.1-py2.py3-none-any.whl (11 kB)
Collecting websocket-client==1.4.2 (from m3_learning)
  Using cached websocket_client-1.4.2-py3-none-any.whl (55 kB)
Collecting Werkzeug==2.2.2 (from m3_learning)
  Using cached Werkzeug-2.2.2-py3-none-any.whl (232 kB)
Requirement already satisfied: wget==3.2 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from m3_learning) (3.2)
Collecting widgetsnbextension==4.0.3 (from m3_learning)
  Using cached widgetsnbextension-4.0.3-py3-none-any.whl (2.0 MB)
Collecting wincertstore==0.2 (from m3_learning)
  Using cached wincertstore-0.2-py2.py3-none-any.whl (8.8 kB)
Collecting wrapt==1.14.1 (from m3_learning)
  Using cached wrapt-1.14.1-cp310-cp310-win_amd64.whl (35 kB)
Requirement already satisfied: xlrd==2.0.1 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from m3_learning) (2.0.1)
Collecting zenodopy==0.3.0 (from m3_learning)
  Using cached zenodopy-0.3.0-py3-none-any.whl
Collecting zict==2.2.0 (from m3_learning)
  Using cached zict-2.2.0-py2.py3-none-any.whl (23 kB)
Collecting zipfile38==0.0.3 (from m3_learning)
  Using cached zipfile38-0.0.3-py3-none-any.whl
Collecting hyperspy==1.7.4 (from m3_learning)
  Downloading hyperspy-1.7.4-cp310-cp310-win_amd64.whl (32.6 MB)
     ---------------------------------------- 32.6/32.6 MB 5.7 MB/s eta 0:00:00
Requirement already satisfied: wheel&lt;1.0,&gt;=0.23.0 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from astunparse==1.6.3-&gt;m3_learning) (0.38.4)
Requirement already satisfied: requests[socks] in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from gdown==4.5.3-&gt;m3_learning) (2.31.0)
Requirement already satisfied: traits&gt;=4.5.0 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from hyperspy==1.7.4-&gt;m3_learning) (6.4.2)
Requirement already satisfied: natsort in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from hyperspy==1.7.4-&gt;m3_learning) (8.4.0)
Requirement already satisfied: sympy in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from hyperspy==1.7.4-&gt;m3_learning) (1.12)
Requirement already satisfied: dill in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from hyperspy==1.7.4-&gt;m3_learning) (0.3.7)
Requirement already satisfied: ipyparallel in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from hyperspy==1.7.4-&gt;m3_learning) (8.6.1)
Requirement already satisfied: pint&gt;=0.10 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from hyperspy==1.7.4-&gt;m3_learning) (0.22)
Requirement already satisfied: numexpr in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from hyperspy==1.7.4-&gt;m3_learning) (2.8.5)
Requirement already satisfied: sparse in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from hyperspy==1.7.4-&gt;m3_learning) (0.14.0)
Requirement already satisfied: prettytable in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from hyperspy==1.7.4-&gt;m3_learning) (3.8.0)
Requirement already satisfied: numba&gt;=0.52 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from hyperspy==1.7.4-&gt;m3_learning) (0.56.4)
Requirement already satisfied: importlib-metadata&gt;=3.6 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from hyperspy==1.7.4-&gt;m3_learning) (4.12.0)
Requirement already satisfied: zarr&gt;=2.9.0 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from hyperspy==1.7.4-&gt;m3_learning) (2.16.1)
Requirement already satisfied: pywin32&gt;=1.0 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from jupyter-core==4.11.2-&gt;m3_learning) (305.1)
Collecting pywinpty (from jupyter-server==1.21.0-&gt;m3_learning)
  Obtaining dependency information for pywinpty from https://files.pythonhosted.org/packages/e2/d2/9c69757e0c29e4d3bbc2b499800eb713e97cd8e080af1dd7cf9ab4e18626/pywinpty-2.0.11-cp310-none-win_amd64.whl.metadata
  Downloading pywinpty-2.0.11-cp310-none-win_amd64.whl.metadata (5.2 kB)
Requirement already satisfied: setuptools&gt;=41.0.0 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from tensorboard==2.10.1-&gt;m3_learning) (68.0.0)
Requirement already satisfied: zipp&gt;=0.5 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from importlib-metadata&gt;=3.6-&gt;hyperspy==1.7.4-&gt;m3_learning) (3.16.2)
Requirement already satisfied: llvmlite&lt;0.40,&gt;=0.39.0dev0 in c:\users\jca92\appdata\roaming\python\python310\site-packages (from numba&gt;=0.52-&gt;hyperspy==1.7.4-&gt;m3_learning) (0.39.1)
Requirement already satisfied: asciitree in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from zarr&gt;=2.9.0-&gt;hyperspy==1.7.4-&gt;m3_learning) (0.3.3)
Requirement already satisfied: fasteners in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from zarr&gt;=2.9.0-&gt;hyperspy==1.7.4-&gt;m3_learning) (0.18)
Requirement already satisfied: numcodecs&gt;=0.10.0 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from zarr&gt;=2.9.0-&gt;hyperspy==1.7.4-&gt;m3_learning) (0.11.0)
INFO: pip is looking at multiple versions of requests[socks] to determine which version is compatible with other requirements. This could take a while.
Collecting requests[socks] (from gdown==4.5.3-&gt;m3_learning)
  Downloading requests-2.30.0-py3-none-any.whl (62 kB)
     ---------------------------------------- 62.5/62.5 kB 3.5 MB/s eta 0:00:00
  Downloading requests-2.29.0-py3-none-any.whl (62 kB)
     ---------------------------------------- 62.5/62.5 kB ? eta 0:00:00
  Downloading requests-2.28.2-py3-none-any.whl (62 kB)
     ---------------------------------------- 62.8/62.8 kB ? eta 0:00:00
Requirement already satisfied: mpmath&gt;=0.19 in c:\users\jca92\.conda\envs\tutorials\lib\site-packages (from sympy-&gt;hyperspy==1.7.4-&gt;m3_learning) (1.3.0)
Downloading pywinpty-2.0.11-cp310-none-win_amd64.whl (1.4 MB)
   ---------------------------------------- 1.4/1.4 MB 9.9 MB/s eta 0:00:00
Installing collected packages: zipfile38, wincertstore, webencodings, wcwidth, types-urllib3, tensorboard-plugin-wit, Send2Trash, pytz, msgpack, mistune, libclang, keras, ipython-genutils, HeapDict, flatbuffers, fastjsonschema, zict, wrapt, widgetsnbextension, websocket-client, urllib3, typing-extensions, types-requests, traitlets, tqdm, tomli, tinycss2, threadpoolctl, termcolor, tensorflow-io-gcs-filesystem, tensorflow-estimator, tensorboard-data-server, soupsieve, sniffio, pyzmq, PyYAML, pywinpty, PySocks, pyrsistent, Pygments, pycparser, pycodestyle, psutil, protobuf, prompt-toolkit, prometheus-client, Pillow, pandocfilters, packaging, numpy, networkx, MarkupSafe, jupyterlab-widgets, jupyterlab-pygments, joblib, jedi, grpcio, fonttools, filelock, defusedxml, debugpy, charset-normalizer, certifi, cachetools, bleach, attrs, asttokens, absl-py, Werkzeug, torch, tifffile, terminado, stack-data, scipy, requests, QtPy, pandas, jupyter-core, jsonschema, imageio, google-auth, contourpy, cffi, beautifulsoup4, autopep8, anyio, zenodopy, torchvision, scikit-learn, nbformat, matplotlib, ipython, argon2-cffi-bindings, seaborn, nbclient, ipykernel, google-auth-oauthlib, gdown, argon2-cffi, tensorboard, qtconsole, nbconvert, jupyter-console, ipywidgets, tensorflow-gpu, tensorflow, jupyter-server, hyperspy, sidpy, notebook-shim, pyUSID, nbclassic, notebook, BGlib, jupyter, m3_learning
  Attempting uninstall: wcwidth
    Found existing installation: wcwidth 0.2.6
    Uninstalling wcwidth-0.2.6:
      Successfully uninstalled wcwidth-0.2.6
  Attempting uninstall: pytz
    Found existing installation: pytz 2023.3
    Uninstalling pytz-2023.3:
      Successfully uninstalled pytz-2023.3
  Attempting uninstall: msgpack
    Found existing installation: msgpack 1.0.5
    Uninstalling msgpack-1.0.5:
      Successfully uninstalled msgpack-1.0.5
  Attempting uninstall: libclang
    Found existing installation: libclang 16.0.6
    Uninstalling libclang-16.0.6:
      Successfully uninstalled libclang-16.0.6
  Attempting uninstall: keras
    Found existing installation: keras 2.13.1
    Uninstalling keras-2.13.1:
      Successfully uninstalled keras-2.13.1
  Attempting uninstall: flatbuffers
    Found existing installation: flatbuffers 23.5.26
    Uninstalling flatbuffers-23.5.26:
      Successfully uninstalled flatbuffers-23.5.26
  Attempting uninstall: fastjsonschema
    Found existing installation: fastjsonschema 2.18.0
    Uninstalling fastjsonschema-2.18.0:
      Successfully uninstalled fastjsonschema-2.18.0
  Attempting uninstall: zict
    Found existing installation: zict 3.0.0
    Uninstalling zict-3.0.0:
      Successfully uninstalled zict-3.0.0
  Attempting uninstall: wrapt
    Found existing installation: wrapt 1.15.0
    Uninstalling wrapt-1.15.0:
      Successfully uninstalled wrapt-1.15.0
  Attempting uninstall: widgetsnbextension
    Found existing installation: widgetsnbextension 4.0.8
    Uninstalling widgetsnbextension-4.0.8:
      Successfully uninstalled widgetsnbextension-4.0.8
  Attempting uninstall: urllib3
    Found existing installation: urllib3 1.26.16
    Uninstalling urllib3-1.26.16:
      Successfully uninstalled urllib3-1.26.16
  Attempting uninstall: typing-extensions
    Found existing installation: typing_extensions 4.5.0
    Uninstalling typing_extensions-4.5.0:
      Successfully uninstalled typing_extensions-4.5.0
  Attempting uninstall: traitlets
    Found existing installation: traitlets 5.9.0
    Uninstalling traitlets-5.9.0:
      Successfully uninstalled traitlets-5.9.0
  Attempting uninstall: tqdm
    Found existing installation: tqdm 4.66.1
    Uninstalling tqdm-4.66.1:
      Successfully uninstalled tqdm-4.66.1
  Attempting uninstall: threadpoolctl
    Found existing installation: threadpoolctl 3.2.0
    Uninstalling threadpoolctl-3.2.0:
      Successfully uninstalled threadpoolctl-3.2.0
  Attempting uninstall: termcolor
    Found existing installation: termcolor 2.3.0
    Uninstalling termcolor-2.3.0:
      Successfully uninstalled termcolor-2.3.0
  Attempting uninstall: tensorflow-io-gcs-filesystem
    Found existing installation: tensorflow-io-gcs-filesystem 0.31.0
    Uninstalling tensorflow-io-gcs-filesystem-0.31.0:
      Successfully uninstalled tensorflow-io-gcs-filesystem-0.31.0
  Attempting uninstall: tensorflow-estimator
    Found existing installation: tensorflow-estimator 2.13.0
    Uninstalling tensorflow-estimator-2.13.0:
      Successfully uninstalled tensorflow-estimator-2.13.0
  Attempting uninstall: tensorboard-data-server
    Found existing installation: tensorboard-data-server 0.7.1
    Uninstalling tensorboard-data-server-0.7.1:
      Successfully uninstalled tensorboard-data-server-0.7.1
  Attempting uninstall: soupsieve
    Found existing installation: soupsieve 2.5
    Uninstalling soupsieve-2.5:
      Successfully uninstalled soupsieve-2.5
  Attempting uninstall: pyzmq
    Found existing installation: pyzmq 23.2.1
    Uninstalling pyzmq-23.2.1:
      Successfully uninstalled pyzmq-23.2.1
  Attempting uninstall: PyYAML
    Found existing installation: PyYAML 6.0.1
    Uninstalling PyYAML-6.0.1:
      Successfully uninstalled PyYAML-6.0.1
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DEPRECATION: sidpy 0.11 has a non-standard dependency specifier distributed&gt;=2.0.0psutil. pip 23.3 will enforce this behaviour change. A possible replacement is to upgrade to a newer version of sidpy or contact the author to suggest that they release a version with a conforming dependency specifiers. Discussion can be found at https://github.com/pypa/pip/issues/12063
ERROR: Could not install packages due to an OSError: [WinError 5] Access is denied: &#39;C:\\Users\\jca92\\.conda\\envs\\tutorials\\Lib\\site-packages\\~aml\\_yaml.cp310-win_amd64.pyd&#39;
Consider using the `--user` option or check the permissions.
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">io</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
<span class="kn">import</span> <span class="nn">torch.autograd</span> <span class="k">as</span> <span class="nn">autograd</span>
<span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">torchsummary</span> <span class="kn">import</span> <span class="n">summary</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DataLoader</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">from</span> <span class="nn">m3_learning.nn.time_series_nn.nn_util</span> <span class="kn">import</span> <span class="n">Train</span><span class="p">,</span> <span class="n">transform_nn</span>
<span class="kn">from</span> <span class="nn">m3_learning.viz.layout</span> <span class="kn">import</span> <span class="n">layout_fig</span>
<span class="kn">from</span> <span class="nn">m3_learning.viz.nn</span> <span class="kn">import</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">latent_generator</span>
<span class="kn">from</span> <span class="nn">m3_learning.util.rand_util</span> <span class="kn">import</span> <span class="n">rand_tensor</span>
<span class="kn">from</span> <span class="nn">m3_learning.viz.style</span> <span class="kn">import</span> <span class="n">set_style</span>
<span class="kn">from</span> <span class="nn">m3_learning.nn.random</span> <span class="kn">import</span> <span class="n">random_seed</span>
<span class="kn">from</span> <span class="nn">m3_learning.viz.nn</span> <span class="kn">import</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">latent_generator</span>
<span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;printing&quot;</span><span class="p">)</span>
<span class="n">random_seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="o">%</span><span class="k">matplotlib</span> inline


<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CUDA_DEVICE_ORDER&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PCI_BUS_ID&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CUDA_VISIBLE_DEVICES&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">Input In [2],</span> in <span class="ni">&lt;cell line: 17&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="kn">import</span> <span class="nn">time</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="kn">import</span> <span class="nn">math</span>
<span class="ne">---&gt; </span><span class="mi">17</span> <span class="kn">from</span> <span class="nn">m3_learning.nn.time_series_nn.nn_util</span> <span class="kn">import</span> <span class="n">Train</span><span class="p">,</span> <span class="n">transform_nn</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="kn">from</span> <span class="nn">m3_learning.viz.layout</span> <span class="kn">import</span> <span class="n">layout_fig</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="kn">from</span> <span class="nn">m3_learning.viz.nn</span> <span class="kn">import</span> <span class="n">embeddings</span><span class="p">,</span> <span class="n">latent_generator</span>

<span class="n">File</span> <span class="o">~</span>\<span class="o">.</span><span class="n">conda</span>\<span class="n">envs</span>\<span class="n">tutorials</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">m3_learning</span>\<span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">viz</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">be</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">optimizers</span>

<span class="n">File</span> <span class="o">~</span>\<span class="o">.</span><span class="n">conda</span>\<span class="n">envs</span>\<span class="n">tutorials</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">m3_learning</span>\<span class="n">be</span>\<span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">processing</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">util</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">dataset</span>

<span class="n">File</span> <span class="o">~</span>\<span class="o">.</span><span class="n">conda</span>\<span class="n">envs</span>\<span class="n">tutorials</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">m3_learning</span>\<span class="n">be</span>\<span class="n">processing</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="kn">import</span> <span class="nn">time</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">special</span>
<span class="ne">---&gt; </span><span class="mi">12</span> <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="kn">import</span> <span class="nn">os</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="kn">from</span> <span class="nn">BGlib</span> <span class="kn">import</span> <span class="n">be</span> <span class="k">as</span> <span class="n">belib</span>

<span class="n">File</span> <span class="o">~</span>\<span class="o">.</span><span class="n">conda</span>\<span class="n">envs</span>\<span class="n">tutorials</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">tensorflow</span>\<span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">478</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">    </span><span class="mi">473</span> <span class="c1"># Do an eager load for Keras&#39; code so that any function/method that needs to</span>
<span class="g g-Whitespace">    </span><span class="mi">474</span> <span class="c1"># happen at load time will trigger, eg registration of optimizers in the</span>
<span class="g g-Whitespace">    </span><span class="mi">475</span> <span class="c1"># SavedModel registry.</span>
<span class="g g-Whitespace">    </span><span class="mi">476</span> <span class="c1"># See b/196254385 for more details.</span>
<span class="g g-Whitespace">    </span><span class="mi">477</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">478</span>   <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s2">&quot;keras.optimizers&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">479</span> <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span>   <span class="k">pass</span>

<span class="nn">File ~\.conda\envs\tutorials\lib\importlib\__init__.py:126,</span> in <span class="ni">import_module</span><span class="nt">(name, package)</span>
<span class="g g-Whitespace">    </span><span class="mi">124</span>             <span class="k">break</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>         <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="ne">--&gt; </span><span class="mi">126</span> <span class="k">return</span> <span class="n">_bootstrap</span><span class="o">.</span><span class="n">_gcd_import</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">level</span><span class="p">:],</span> <span class="n">package</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

<span class="n">File</span> <span class="o">~</span>\<span class="o">.</span><span class="n">conda</span>\<span class="n">envs</span>\<span class="n">tutorials</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">keras</span>\<span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">21</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Implementation of the Keras API, the high-level API of TensorFlow.</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">17</span><span class="sd"> Detailed documentation and user guides are available at</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span><span class="sd"> [keras.io](https://keras.io).</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">distribute</span>
<span class="ne">---&gt; </span><span class="mi">21</span> <span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">models</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="kn">from</span> <span class="nn">keras.engine.input_layer</span> <span class="kn">import</span> <span class="n">Input</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="kn">from</span> <span class="nn">keras.engine.sequential</span> <span class="kn">import</span> <span class="n">Sequential</span>

<span class="n">File</span> <span class="o">~</span>\<span class="o">.</span><span class="n">conda</span>\<span class="n">envs</span>\<span class="n">tutorials</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">keras</span>\<span class="n">models</span>\<span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Copyright 2022 The TensorFlow Authors. All Rights Reserved.</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="c1">#</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="c1"># limitations under the License.</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="c1"># ==============================================================================</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Keras models API.&quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">18</span> <span class="kn">from</span> <span class="nn">keras.engine.functional</span> <span class="kn">import</span> <span class="n">Functional</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="kn">from</span> <span class="nn">keras.engine.sequential</span> <span class="kn">import</span> <span class="n">Sequential</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="kn">from</span> <span class="nn">keras.engine.training</span> <span class="kn">import</span> <span class="n">Model</span>

<span class="n">File</span> <span class="o">~</span>\<span class="o">.</span><span class="n">conda</span>\<span class="n">envs</span>\<span class="n">tutorials</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">keras</span>\<span class="n">engine</span>\<span class="n">functional</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">27</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="kn">import</span> <span class="nn">tensorflow.compat.v2</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span> <span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">backend</span>
<span class="ne">---&gt; </span><span class="mi">27</span> <span class="kn">from</span> <span class="nn">keras.dtensor</span> <span class="kn">import</span> <span class="n">layout_map</span> <span class="k">as</span> <span class="n">layout_map_lib</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="kn">from</span> <span class="nn">keras.engine</span> <span class="kn">import</span> <span class="n">base_layer</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="kn">from</span> <span class="nn">keras.engine</span> <span class="kn">import</span> <span class="n">base_layer_utils</span>

<span class="n">File</span> <span class="o">~</span>\<span class="o">.</span><span class="n">conda</span>\<span class="n">envs</span>\<span class="n">tutorials</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">keras</span>\<span class="n">dtensor</span>\<span class="n">layout_map</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">27</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="kn">from</span> <span class="nn">keras.dtensor</span> <span class="kn">import</span> <span class="n">lazy_variable</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span> <span class="kn">from</span> <span class="nn">keras.dtensor</span> <span class="kn">import</span> <span class="n">utils</span>
<span class="ne">---&gt; </span><span class="mi">27</span> <span class="kn">from</span> <span class="nn">keras.engine</span> <span class="kn">import</span> <span class="n">base_layer</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="c1"># isort: off</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="kn">from</span> <span class="nn">tensorflow.python.util.deprecation</span> <span class="kn">import</span> <span class="n">deprecated</span>

<span class="n">File</span> <span class="o">~</span>\<span class="o">.</span><span class="n">conda</span>\<span class="n">envs</span>\<span class="n">tutorials</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">keras</span>\<span class="n">engine</span>\<span class="n">base_layer</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">43</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span> <span class="kn">from</span> <span class="nn">keras.mixed_precision</span> <span class="kn">import</span> <span class="n">loss_scale_optimizer</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span> <span class="kn">from</span> <span class="nn">keras.mixed_precision</span> <span class="kn">import</span> <span class="n">policy</span>
<span class="ne">---&gt; </span><span class="mi">43</span> <span class="kn">from</span> <span class="nn">keras.saving.saved_model</span> <span class="kn">import</span> <span class="n">layer_serialization</span>
<span class="g g-Whitespace">     </span><span class="mi">44</span> <span class="kn">from</span> <span class="nn">keras.utils</span> <span class="kn">import</span> <span class="n">generic_utils</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span> <span class="kn">from</span> <span class="nn">keras.utils</span> <span class="kn">import</span> <span class="n">layer_utils</span>

<span class="n">File</span> <span class="o">~</span>\<span class="o">.</span><span class="n">conda</span>\<span class="n">envs</span>\<span class="n">tutorials</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">keras</span>\<span class="n">saving</span>\<span class="n">saved_model</span>\<span class="n">layer_serialization</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">22</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="kn">from</span> <span class="nn">keras.saving.saved_model</span> <span class="kn">import</span> <span class="n">base_serialization</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="kn">from</span> <span class="nn">keras.saving.saved_model</span> <span class="kn">import</span> <span class="n">constants</span>
<span class="ne">---&gt; </span><span class="mi">22</span> <span class="kn">from</span> <span class="nn">keras.saving.saved_model</span> <span class="kn">import</span> <span class="n">save_impl</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="kn">from</span> <span class="nn">keras.saving.saved_model</span> <span class="kn">import</span> <span class="n">serialized_attributes</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="kn">from</span> <span class="nn">keras.utils</span> <span class="kn">import</span> <span class="n">generic_utils</span>

<span class="n">File</span> <span class="o">~</span>\<span class="o">.</span><span class="n">conda</span>\<span class="n">envs</span>\<span class="n">tutorials</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">keras</span>\<span class="n">saving</span>\<span class="n">saved_model</span>\<span class="n">save_impl</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">34</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="kn">from</span> <span class="nn">keras.saving</span> <span class="kn">import</span> <span class="n">saving_utils</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="kn">from</span> <span class="nn">keras.saving.saved_model</span> <span class="kn">import</span> <span class="n">constants</span>
<span class="ne">---&gt; </span><span class="mi">34</span> <span class="kn">from</span> <span class="nn">keras.saving.saved_model</span> <span class="kn">import</span> <span class="n">load</span> <span class="k">as</span> <span class="n">keras_load</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span> <span class="kn">from</span> <span class="nn">keras.saving.saved_model</span> <span class="kn">import</span> <span class="n">serialized_attributes</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span> <span class="kn">from</span> <span class="nn">keras.saving.saved_model</span> <span class="kn">import</span> <span class="n">utils</span>

<span class="n">File</span> <span class="o">~</span>\<span class="o">.</span><span class="n">conda</span>\<span class="n">envs</span>\<span class="n">tutorials</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">keras</span>\<span class="n">saving</span>\<span class="n">saved_model</span>\<span class="n">load</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">29</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="kn">from</span> <span class="nn">keras.engine</span> <span class="kn">import</span> <span class="n">input_spec</span>
<span class="g g-Whitespace">     </span><span class="mi">28</span> <span class="kn">from</span> <span class="nn">keras.optimizers.optimizer_v2</span> <span class="kn">import</span> <span class="n">optimizer_v2</span>
<span class="ne">---&gt; </span><span class="mi">29</span> <span class="kn">from</span> <span class="nn">keras.protobuf</span> <span class="kn">import</span> <span class="n">saved_metadata_pb2</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span> <span class="kn">from</span> <span class="nn">keras.protobuf</span> <span class="kn">import</span> <span class="n">versions_pb2</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> <span class="kn">from</span> <span class="nn">keras.saving</span> <span class="kn">import</span> <span class="n">saving_utils</span>

<span class="n">File</span> <span class="o">~</span>\<span class="o">.</span><span class="n">conda</span>\<span class="n">envs</span>\<span class="n">tutorials</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">keras</span>\<span class="n">protobuf</span>\<span class="n">saved_metadata_pb2</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="c1"># @@protoc_insertion_point(imports)</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="n">_sym_db</span> <span class="o">=</span> <span class="n">_symbol_database</span><span class="o">.</span><span class="n">Default</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">16</span> <span class="kn">from</span> <span class="nn">keras.protobuf</span> <span class="kn">import</span> <span class="n">versions_pb2</span> <span class="k">as</span> <span class="n">keras_dot_protobuf_dot_versions__pb2</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="n">DESCRIPTOR</span> <span class="o">=</span> <span class="n">_descriptor</span><span class="o">.</span><span class="n">FileDescriptor</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>   <span class="n">name</span><span class="o">=</span><span class="s1">&#39;keras/protobuf/saved_metadata.proto&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span>   <span class="n">package</span><span class="o">=</span><span class="s1">&#39;third_party.py.keras.protobuf&#39;</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span>   <span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span>   <span class="n">dependencies</span><span class="o">=</span><span class="p">[</span><span class="n">keras_dot_protobuf_dot_versions__pb2</span><span class="o">.</span><span class="n">DESCRIPTOR</span><span class="p">,])</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> <span class="n">_SAVEDMETADATA</span> <span class="o">=</span> <span class="n">_descriptor</span><span class="o">.</span><span class="n">Descriptor</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span>   <span class="n">name</span><span class="o">=</span><span class="s1">&#39;SavedMetadata&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span>   <span class="n">full_name</span><span class="o">=</span><span class="s1">&#39;third_party.py.keras.protobuf.SavedMetadata&#39;</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span>   <span class="n">serialized_end</span><span class="o">=</span><span class="mi">175</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span> <span class="p">)</span>

<span class="n">File</span> <span class="o">~</span>\<span class="o">.</span><span class="n">conda</span>\<span class="n">envs</span>\<span class="n">tutorials</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span>\<span class="n">keras</span>\<span class="n">protobuf</span>\<span class="n">versions_pb2</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="n">_sym_db</span> <span class="o">=</span> <span class="n">_symbol_database</span><span class="o">.</span><span class="n">Default</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="n">DESCRIPTOR</span> <span class="o">=</span> <span class="n">_descriptor</span><span class="o">.</span><span class="n">FileDescriptor</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>   <span class="n">name</span><span class="o">=</span><span class="s1">&#39;keras/protobuf/versions.proto&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>   <span class="n">package</span><span class="o">=</span><span class="s1">&#39;third_party.py.keras.protobuf&#39;</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>   <span class="n">serialized_pb</span><span class="o">=</span><span class="n">_b</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\x1d</span><span class="s1">keras/protobuf/versions.proto</span><span class="se">\x12\x1d</span><span class="s1">third_party.py.keras.protobuf</span><span class="se">\&quot;</span><span class="s1">K</span><span class="se">\n\n</span><span class="s1">VersionDef</span><span class="se">\x12\x10\n\x08</span><span class="s1">producer</span><span class="se">\x18\x01</span><span class="s1"> </span><span class="se">\x01</span><span class="s1">(</span><span class="se">\x05\x12\x14\n\x0c</span><span class="s1">min_consumer</span><span class="se">\x18\x02</span><span class="s1"> </span><span class="se">\x01</span><span class="s1">(</span><span class="se">\x05\x12\x15\n\r</span><span class="s1">bad_consumers</span><span class="se">\x18\x03</span><span class="s1"> </span><span class="se">\x03</span><span class="s1">(</span><span class="se">\x05\x62\x06</span><span class="s1">proto3&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="n">_VERSIONDEF</span> <span class="o">=</span> <span class="n">_descriptor</span><span class="o">.</span><span class="n">Descriptor</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">30</span>   <span class="n">name</span><span class="o">=</span><span class="s1">&#39;VersionDef&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span>   <span class="n">full_name</span><span class="o">=</span><span class="s1">&#39;third_party.py.keras.protobuf.VersionDef&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span>   <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span>   <span class="n">file</span><span class="o">=</span><span class="n">DESCRIPTOR</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span>   <span class="n">containing_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span>   <span class="n">fields</span><span class="o">=</span><span class="p">[</span>
<span class="ne">---&gt; </span><span class="mi">36</span>     <span class="n">_descriptor</span><span class="o">.</span><span class="n">FieldDescriptor</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span>       <span class="n">name</span><span class="o">=</span><span class="s1">&#39;producer&#39;</span><span class="p">,</span> <span class="n">full_name</span><span class="o">=</span><span class="s1">&#39;third_party.py.keras.protobuf.VersionDef.producer&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span>       <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cpp_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span>       <span class="n">has_default_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">40</span>       <span class="n">message_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enum_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">containing_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>       <span class="n">is_extension</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extension_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span>       <span class="n">serialized_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">DESCRIPTOR</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">43</span>     <span class="n">_descriptor</span><span class="o">.</span><span class="n">FieldDescriptor</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">44</span>       <span class="n">name</span><span class="o">=</span><span class="s1">&#39;min_consumer&#39;</span><span class="p">,</span> <span class="n">full_name</span><span class="o">=</span><span class="s1">&#39;third_party.py.keras.protobuf.VersionDef.min_consumer&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span>       <span class="n">number</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cpp_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span>       <span class="n">has_default_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span>       <span class="n">message_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enum_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">containing_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span>       <span class="n">is_extension</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extension_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span>       <span class="n">serialized_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">DESCRIPTOR</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span>     <span class="n">_descriptor</span><span class="o">.</span><span class="n">FieldDescriptor</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span>       <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bad_consumers&#39;</span><span class="p">,</span> <span class="n">full_name</span><span class="o">=</span><span class="s1">&#39;third_party.py.keras.protobuf.VersionDef.bad_consumers&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>       <span class="n">number</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cpp_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span>       <span class="n">has_default_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="p">[],</span>
<span class="g g-Whitespace">     </span><span class="mi">54</span>       <span class="n">message_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enum_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">containing_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span>       <span class="n">is_extension</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extension_scope</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span>       <span class="n">serialized_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">DESCRIPTOR</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span>   <span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span>   <span class="n">extensions</span><span class="o">=</span><span class="p">[</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span>   <span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span>   <span class="n">nested_types</span><span class="o">=</span><span class="p">[],</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span>   <span class="n">enum_types</span><span class="o">=</span><span class="p">[</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span>   <span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span>   <span class="n">serialized_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span>   <span class="n">is_extendable</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">65</span>   <span class="n">syntax</span><span class="o">=</span><span class="s1">&#39;proto3&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">66</span>   <span class="n">extension_ranges</span><span class="o">=</span><span class="p">[],</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span>   <span class="n">oneofs</span><span class="o">=</span><span class="p">[</span>
<span class="g g-Whitespace">     </span><span class="mi">68</span>   <span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span>   <span class="n">serialized_start</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span>   <span class="n">serialized_end</span><span class="o">=</span><span class="mi">139</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span> <span class="n">DESCRIPTOR</span><span class="o">.</span><span class="n">message_types_by_name</span><span class="p">[</span><span class="s1">&#39;VersionDef&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_VERSIONDEF</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span> <span class="n">_sym_db</span><span class="o">.</span><span class="n">RegisterFileDescriptor</span><span class="p">(</span><span class="n">DESCRIPTOR</span><span class="p">)</span>

<span class="nn">File ~\.conda\envs\tutorials\lib\site-packages\google\protobuf\descriptor.py:561,</span> in <span class="ni">FieldDescriptor.__new__</span><span class="nt">(cls, name, full_name, index, number, type, cpp_type, label, default_value, message_type, enum_type, containing_type, is_extension, extension_scope, options, serialized_options, has_default_value, containing_oneof, json_name, file, create_key)</span>
<span class="g g-Whitespace">    </span><span class="mi">555</span> <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">full_name</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">cpp_type</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">556</span>             <span class="n">default_value</span><span class="p">,</span> <span class="n">message_type</span><span class="p">,</span> <span class="n">enum_type</span><span class="p">,</span> <span class="n">containing_type</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">557</span>             <span class="n">is_extension</span><span class="p">,</span> <span class="n">extension_scope</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">558</span>             <span class="n">serialized_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">559</span>             <span class="n">has_default_value</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">containing_oneof</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">560</span>             <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">create_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># pylint: disable=redefined-builtin</span>
<span class="ne">--&gt; </span><span class="mi">561</span>   <span class="n">_message</span><span class="o">.</span><span class="n">Message</span><span class="o">.</span><span class="n">_CheckCalledFromGeneratedFile</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">562</span>   <span class="k">if</span> <span class="n">is_extension</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">563</span>     <span class="k">return</span> <span class="n">_message</span><span class="o">.</span><span class="n">default_pool</span><span class="o">.</span><span class="n">FindExtensionByName</span><span class="p">(</span><span class="n">full_name</span><span class="p">)</span>

<span class="ne">TypeError</span>: Descriptors cannot not be created directly.
<span class="n">If</span> <span class="n">this</span> <span class="n">call</span> <span class="n">came</span> <span class="kn">from</span> <span class="nn">a</span> <span class="n">_pb2</span><span class="o">.</span><span class="n">py</span> <span class="n">file</span><span class="p">,</span> <span class="n">your</span> <span class="n">generated</span> <span class="n">code</span> <span class="ow">is</span> <span class="n">out</span> <span class="n">of</span> <span class="n">date</span> <span class="ow">and</span> <span class="n">must</span> <span class="n">be</span> <span class="n">regenerated</span> <span class="k">with</span> <span class="n">protoc</span> <span class="o">&gt;=</span> <span class="mf">3.19.0</span><span class="o">.</span>
<span class="n">If</span> <span class="n">you</span> <span class="n">cannot</span> <span class="n">immediately</span> <span class="n">regenerate</span> <span class="n">your</span> <span class="n">protos</span><span class="p">,</span> <span class="n">some</span> <span class="n">other</span> <span class="n">possible</span> <span class="n">workarounds</span> <span class="n">are</span><span class="p">:</span>
<span class="g g-Whitespace"> </span><span class="mi">1</span><span class="o">.</span> <span class="n">Downgrade</span> <span class="n">the</span> <span class="n">protobuf</span> <span class="n">package</span> <span class="n">to</span> <span class="mf">3.20</span><span class="o">.</span><span class="n">x</span> <span class="ow">or</span> <span class="n">lower</span><span class="o">.</span>
<span class="g g-Whitespace"> </span><span class="mi">2</span><span class="o">.</span> <span class="n">Set</span> <span class="n">PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION</span><span class="o">=</span><span class="n">python</span> <span class="p">(</span><span class="n">but</span> <span class="n">this</span> <span class="n">will</span> <span class="n">use</span> <span class="n">pure</span><span class="o">-</span><span class="n">Python</span> <span class="n">parsing</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">much</span> <span class="n">slower</span><span class="p">)</span><span class="o">.</span>

<span class="n">More</span> <span class="n">information</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">developers</span><span class="o">.</span><span class="n">google</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">protocol</span><span class="o">-</span><span class="n">buffers</span><span class="o">/</span><span class="n">docs</span><span class="o">/</span><span class="n">news</span><span class="o">/</span><span class="mi">2022</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">06</span><span class="c1">#python-updates</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="generating-some-data-based-on-the-image">
<h2>Generating some data based on the image<a class="headerlink" href="#generating-some-data-based-on-the-image" title="Permalink to this heading">#</a></h2>
<section id="define-a-non-linear-function">
<h3>Define a non-linear function<a class="headerlink" href="#define-a-non-linear-function" title="Permalink to this heading">#</a></h3>
<center> $$ y = A sin(2\theta f+ \phi)$$ </center>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Sin_func</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class that computes the Sin function</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x_vector</span><span class="p">,</span>
        <span class="n">amp</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">phase</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">frequency</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            x_vector:</span>
<span class="sd">            sd (array, float): range for the standard deviation</span>
<span class="sd">            mean (array, float): range for the mean</span>
<span class="sd">            amp (array, float): range for the amplitude</span>
<span class="sd">            size (tuple): Size of the array first index is number of channels, second is number of functions</span>
<span class="sd">            verbose (bool): shows outputs</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x_vector</span> <span class="o">=</span> <span class="n">x_vector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">amp</span> <span class="o">=</span> <span class="n">amp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amp_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">amp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amp_sd</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">amp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">amp</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">phase</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">phase</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase_sd</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">phase</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">phase</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">frequency</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_sd</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">frequency</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span>
                      <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">12</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

    <span class="k">def</span> <span class="nf">compute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            self (object): Returns the instance itself.</span>
<span class="sd">            device (string, optional) : Sets the device to do the computation. Default `cpu`, common option `cuda`</span>

<span class="sd">        Returns: out (Tensor): spectra.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">size</span><span class="p">())</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_vector</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>

            <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">_amp</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">_phase</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">_frequency</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">_amp</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">_phase</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">_frequency</span> <span class="o">=</span> <span class="n">params</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>

            <span class="n">x_vector</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x_vector</span><span class="p">])</span>
                <span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">x_vector</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">x_vector</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># .to(device)</span>

            <span class="n">_out</span> <span class="o">=</span> <span class="n">_amp</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span>
                <span class="mi">2</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">_frequency</span> <span class="o">*</span> <span class="n">x_vector</span> <span class="o">+</span> <span class="n">_phase</span>
            <span class="p">)</span>

            <span class="n">out</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">_out</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">out</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            device (str): device where computation happens</span>

<span class="sd">        Returns:</span>
<span class="sd">            out (Tensor) : Generated spectra</span>
<span class="sd">            params (Tensor) : parameters used for generation</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">phase</span> <span class="o">=</span> <span class="n">rand_tensor</span><span class="p">(</span>
            <span class="nb">min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nb">max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">)</span>
        <span class="n">frequency</span> <span class="o">=</span> <span class="n">rand_tensor</span><span class="p">(</span>
            <span class="nb">min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nb">max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">)</span>
        <span class="n">amp</span> <span class="o">=</span> <span class="n">rand_tensor</span><span class="p">(</span>
            <span class="nb">min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">amp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nb">max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">amp</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="p">)</span>
        <span class="n">_params</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">amp</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">frequency</span><span class="p">))</span>

        <span class="n">_params</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">_params</span><span class="p">)</span>
        <span class="n">_params</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">_params</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">_params</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">_params</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">_params</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span> <span class="n">_params</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">constructor</span> <span class="o">=</span> <span class="n">Sin_func</span><span class="p">(</span>
    <span class="n">amp</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>  <span class="c1"># Sets the amplitude</span>
    <span class="n">phase</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">],</span>  <span class="c1"># Sets the phase</span>
    <span class="n">frequency</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>  <span class="c1"># Sets the frequency</span>
    <span class="n">x_vector</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Sets the x_vector</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># number of samples to generate</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initializes the constructor</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">constructor</span><span class="o">.</span><span class="n">sampler</span><span class="p">()</span>

<span class="c1"># grabs the parameters and the spectra</span>
<span class="n">spectra</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">output</span>

<span class="c1"># This grabs the sum of all spectral and the individual spectra if they exist</span>
<span class="n">spectra_full</span><span class="p">,</span> <span class="n">spectras</span> <span class="o">=</span> <span class="n">spectra</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="visualize-examples">
<h2>Visualize examples<a class="headerlink" href="#visualize-examples" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectras</span><span class="p">[</span><span class="n">rand</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="recurrent-neural-network-autoencoders">
<h2>Recurrent Neural Network Autoencoders<a class="headerlink" href="#recurrent-neural-network-autoencoders" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>It is important to consider the temporal domain</p></li>
<li><p>This can be improved by using a recurrent neural network that processes each time step sequentially.</p></li>
<li><p>To add an understanding about the short and long term information in the data you can add memory and forget logic as a learnable parameter.</p></li>
</ul>
<p><img alt="" src="https://github.com/jagar2/AI_For_Atoms_Autoencoder_Tutorial/blob/main/img/Autoencoder_Med.png?raw=true" /></p>
<p><img alt="" src="https://github.com/jagar2/AI_For_Atoms_Autoencoder_Tutorial/blob/main/img/LSTM%20Node.png?raw=true" /></p>
<section id="builds-the-autoencoder">
<h3>Builds the autoencoder<a class="headerlink" href="#builds-the-autoencoder" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Encoder</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latent_dim</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latent_dim</span> <span class="o">=</span> <span class="n">latent_dim</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Encoder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bidirectional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstm2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bidirectional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">latent_dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">))</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">))</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstm2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>


<span class="k">class</span> <span class="nc">Decoder</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">latent_dim</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">latent_dim</span> <span class="o">=</span> <span class="n">latent_dim</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Decoder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latent_dim</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span>
                            <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bidirectional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstm2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bidirectional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tdd</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">repeat</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">))</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">__</span><span class="p">))</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstm2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tdd</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Autoencoder</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">decoder</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">encoder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">decoder</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>

        <span class="c1"># encode</span>

        <span class="n">embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="c1"># decode</span>

        <span class="n">predicted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">embedding</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">predicted</span>
</pre></div>
</div>
</div>
</div>
<p>Since we know there are intrinsically 3 latent dimensions let’s try and train the model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span>
<span class="n">latent_dim</span> <span class="o">=</span> <span class="mi">3</span>

<span class="n">encoder</span> <span class="o">=</span> <span class="n">Encoder</span><span class="p">(</span><span class="n">latent_dim</span><span class="o">=</span><span class="n">latent_dim</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">decoder</span> <span class="o">=</span> <span class="n">Decoder</span><span class="p">(</span><span class="n">latent_dim</span><span class="o">=</span><span class="n">latent_dim</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Autoencoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">decoder</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># optimizer</span>

<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">3e-5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># views the model</span>

<span class="n">model</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="builds-the-dataloader">
<h3>Builds the dataloader<a class="headerlink" href="#builds-the-dataloader" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># constructs a dataloader for training</span>

<span class="n">dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">spectra_full</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
                        <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># trains the model</span>

<span class="n">random_seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">Train</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">decoder</span><span class="p">,</span> <span class="n">dataloader</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="visualize-the-reconstruction">
<h2>Visualize the reconstruction<a class="headerlink" href="#visualize-the-reconstruction" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># computes an example reconstruction for a mini batch</span>

<span class="p">(</span><span class="n">encoded_</span><span class="p">,</span> <span class="n">decoded_</span><span class="p">)</span> <span class="o">=</span> <span class="n">transform_nn</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">dataloader</span><span class="p">)),</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">decoder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plots a random example of the original and predicted spectra</span>

<span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectras</span><span class="p">[</span><span class="n">rand</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">decoded_</span><span class="p">[</span><span class="n">rand</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Generated&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="generating-validation-data">
<h2>Generating Validation Data<a class="headerlink" href="#generating-validation-data" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>We want to generate a hyperspectral image</p></li>
<li><p>This can be done by taking the RGB values of an image and using them as parameters for a function</p></li>
</ul>
<section id="loads-and-image-of-my-dog-nala">
<h3>Loads and image of my dog Nala<a class="headerlink" href="#loads-and-image-of-my-dog-nala" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Painting by <em>Irene Dogmatic</em></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Loads dog image</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span>
    <span class="s2">&quot;https://github.com/jagar2/m3_learning/blob/main/m3_learning/Tutorials/Unsupervised_Learning_with_AEs/figs/nala.jpg?raw=true&quot;</span>
<span class="p">)</span>

<span class="c1"># Crops dog image</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="mi">200</span><span class="p">:</span><span class="mi">1900</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">:</span><span class="mi">1500</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span> <span class="o">/</span> <span class="mi">255</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="displays-the-image">
<h3>Displays the image<a class="headerlink" href="#displays-the-image" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="generates-the-data-from-rgb-sampling">
<h3>Generates the data from RGB sampling<a class="headerlink" href="#generates-the-data-from-rgb-sampling" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Converts the image into parameters within the generated range</span>

<span class="n">nala_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_3d</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">nala_amp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">nala_params</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.8</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">nala_phase</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">nala_params</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">nala_frequency</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">nala_params</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span>

<span class="n">_nala_params</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">nala_amp</span><span class="p">,</span> <span class="n">nala_phase</span><span class="p">,</span> <span class="n">nala_frequency</span><span class="p">))</span>

<span class="n">_nala_params</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">atleast_3d</span><span class="p">(</span><span class="n">_nala_params</span><span class="p">)</span>
<span class="n">_nala_params</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">_nala_params</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># builds the spectra from the parameters</span>

<span class="p">(</span><span class="n">nala_spectra</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">constructor</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">_nala_params</span><span class="p">)</span>

<span class="c1"># generated the encoded representation and decoded spectra</span>

<span class="p">(</span><span class="n">nala_encoded_</span><span class="p">,</span> <span class="n">nala_decoded_</span><span class="p">)</span> <span class="o">=</span> <span class="n">transform_nn</span><span class="p">(</span><span class="n">nala_spectra</span><span class="p">,</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">decoder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plots a random example of the original and predicted spectra</span>

<span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nala_spectra</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nala_spectra</span><span class="p">[</span><span class="n">rand</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nala_decoded_</span><span class="p">[</span><span class="n">rand</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Generated&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualize-the-learned-results">
<h3>Visualize the learned results<a class="headerlink" href="#visualize-the-learned-results" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize the learned embeddings</span>
<span class="n">embeddings</span><span class="p">(</span><span class="n">nala_encoded_</span><span class="p">,</span> <span class="n">shape_</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize the actual RGB channels.</span>
<span class="n">embeddings</span><span class="p">(</span><span class="n">_nala_params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
           <span class="n">shape_</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>There is minimal resemblance to the true features</strong></p></li>
<li><p>This is unsurprising because there are no rules that define what the embedding should look like.</p></li>
</ul>
</section>
</section>
<section id="let-s-try-a-bigger-model">
<h2>Let’s try a bigger model<a class="headerlink" href="#let-s-try-a-bigger-model" title="Permalink to this heading">#</a></h2>
<section id="builds-the-model">
<h3>Builds the model<a class="headerlink" href="#builds-the-model" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span>
<span class="n">latent_dim</span> <span class="o">=</span> <span class="mi">12</span>

<span class="n">encoder</span> <span class="o">=</span> <span class="n">Encoder</span><span class="p">(</span><span class="n">latent_dim</span><span class="o">=</span><span class="n">latent_dim</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">decoder</span> <span class="o">=</span> <span class="n">Decoder</span><span class="p">(</span><span class="n">latent_dim</span><span class="o">=</span><span class="n">latent_dim</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Autoencoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">decoder</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># optimizer</span>

<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">3e-5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># views the model</span>

<span class="n">model</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="training">
<h2>Training<a class="headerlink" href="#training" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># trains the model</span>

<span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Train</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">decoder</span><span class="p">,</span> <span class="n">dataloader</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h3>Visualize the reconstruction<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># computes an example reconstruction for a minibatch</span>

<span class="p">(</span><span class="n">encoded_</span><span class="p">,</span> <span class="n">decoded_</span><span class="p">)</span> <span class="o">=</span> <span class="n">transform_nn</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">dataloader</span><span class="p">)),</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">decoder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plots a random example of the original and predicted spectra</span>

<span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectras</span><span class="p">[</span><span class="n">rand</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">decoded_</span><span class="p">[</span><span class="n">rand</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Generated&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Reconstruction is slightly better but just more overfit</p></li>
</ul>
</section>
<section id="id2">
<h3>Visualize the learned results<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># builds the spectra from the parameters</span>

<span class="p">(</span><span class="n">nala_spectra</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="n">constructor</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">_nala_params</span><span class="p">)</span>

<span class="c1"># generated the encoded representation and decoded spectra</span>

<span class="p">(</span><span class="n">nala_encoded_</span><span class="p">,</span> <span class="n">nala_decoded_</span><span class="p">)</span> <span class="o">=</span> <span class="n">transform_nn</span><span class="p">(</span><span class="n">nala_spectra</span><span class="p">,</span> <span class="n">encoder</span><span class="p">,</span> <span class="n">decoder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plots a random example of the original and predicted spectra</span>

<span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nala_spectra</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nala_spectra</span><span class="p">[</span><span class="n">rand</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Original&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nala_decoded_</span><span class="p">[</span><span class="n">rand</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Generated&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize the learned embeddings</span>

<span class="n">embeddings</span><span class="p">(</span><span class="n">nala_encoded_</span><span class="p">,</span> <span class="n">shape_</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize the actual RGB channels.</span>
<span class="n">embeddings</span><span class="p">(</span><span class="n">_nala_params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
           <span class="n">shape_</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>Now there are just more features but no resemblance between the parameters.</strong></p></li>
<li><p>It would be impossible to have any resemblance to the features since it is overcomplete.</p></li>
</ul>
</section>
</section>
<section id="physics-constrained-neural-network">
<h2>Physics constrained neural network<a class="headerlink" href="#physics-constrained-neural-network" title="Permalink to this heading">#</a></h2>
<section id="building-the-model">
<h3>Building the model<a class="headerlink" href="#building-the-model" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DensePhysLarger</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x_vector</span><span class="p">,</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="n">dense_params</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">,</span>
        <span class="n">num_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Args:</span>
<span class="sd">            x_vector: The vector of values for x</span>
<span class="sd">            model: the empirical function to fit</span>
<span class="sd">            dense_params: number of output parameters to the model</span>
<span class="sd">            verbose: sets if the model is verbose</span>
<span class="sd">            device: device where the model will run</span>
<span class="sd">            num_channels: number of channels in the input</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dense_params</span> <span class="o">=</span> <span class="n">dense_params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_vector</span> <span class="o">=</span> <span class="n">x_vector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_channels</span> <span class="o">=</span> <span class="n">num_channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_params</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_params&quot;</span><span class="p">)</span>
        <span class="c1"># (self.x_vector, size=(num_channels, dense_params // self.model_params))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigmoid</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>

        <span class="c1"># Input block of 1d convolution</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_channels</span><span class="p">,</span>
                      <span class="n">out_channels</span><span class="o">=</span><span class="mi">8</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">8</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">6</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">6</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x1_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x1</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_channels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_vector</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="p">)</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># fully connected block</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_xfc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hidden_x1_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x1_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">20</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">(),</span>
        <span class="p">)</span>

        <span class="c1"># out of size 20</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_xfc_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_xfc</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x1_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x1_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="p">)</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># 2nd block of 1d-conv layers</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="n">in_channels</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">out_channels</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">AvgPool1d</span><span class="p">(</span><span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x2_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x2</span><span class="p">(</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hidden_xfc_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="mi">1</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x1_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x1_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># Flatten layer</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">flatten_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Flatten</span><span class="p">()</span>

        <span class="c1"># Final embedding block - Output 4 values - linear</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hidden_embedding</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x2_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x2_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_xfc_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="mi">16</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">SELU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense_params</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">xfc</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># batch size, features</span>
        <span class="n">xfc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_xfc</span><span class="p">(</span><span class="n">xfc</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x1_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x1_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_x2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">cnn_flat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">encoded</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">cnn_flat</span><span class="p">,</span> <span class="n">xfc</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># merge dense and 1d conv.</span>

        <span class="n">embedding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hidden_embedding</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>  <span class="c1"># output is 3 parameters</span>

        <span class="n">embedding</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">embedding</span><span class="p">,</span> <span class="p">(</span><span class="n">embedding</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">embedding</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">embedding</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">amp_sd</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">amp_mean</span>
        <span class="p">)</span>
        <span class="n">embedding</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">embedding</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">phase_sd</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">phase_mean</span>
        <span class="p">)</span>
        <span class="n">embedding</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">embedding</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">frequency_sd</span> <span class="o">+</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">frequency_mean</span>
        <span class="p">)</span>

        <span class="n">embedding</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">embedding</span><span class="p">,</span> <span class="p">(</span><span class="n">embedding</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">embedding</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">embedding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embed</span> <span class="o">=</span> <span class="n">embedding</span>

        <span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">embedding</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">atleast_3d</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">embedding</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_vector</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">DensePhysLarger</span><span class="p">(</span>
    <span class="n">x_vector</span><span class="p">,</span> <span class="n">constructor</span><span class="p">,</span> <span class="n">dense_params</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">model_params</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
    <span class="n">model</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="dataloader">
<h3>Dataloader<a class="headerlink" href="#dataloader" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># builds the dataloader</span>

<span class="n">dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">spectra_full</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h3>Training<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">loss_func</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>

<span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">3e-5</span><span class="p">)</span>


<span class="n">epochs</span> <span class="o">=</span> <span class="mi">200</span>

<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">train_loss</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">total_num</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">train_batch</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>
        <span class="n">pred</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">train_batch</span><span class="o">.</span><span class="n">cuda</span><span class="p">())</span>

        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_func</span><span class="p">(</span><span class="n">train_batch</span><span class="o">.</span><span class="n">cuda</span><span class="p">(),</span> <span class="n">pred</span><span class="p">)</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">train_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">*</span> <span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">total_num</span> <span class="o">+=</span> <span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

    <span class="n">train_loss</span> <span class="o">/=</span> <span class="n">total_num</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;epoch : </span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">, recon loss = </span><span class="si">{:.8f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- </span><span class="si">%s</span><span class="s2"> seconds ---&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="validation">
<h3>Validation<a class="headerlink" href="#validation" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spectra_generated</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">train_batch</span><span class="o">.</span><span class="n">cuda</span><span class="p">())</span>
<span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">272</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra_generated</span><span class="p">[</span><span class="n">rand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_batch</span><span class="p">[</span><span class="n">rand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">rand</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nala_spectra_generated</span><span class="p">,</span> <span class="n">nala_params</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span>
    <span class="n">nala_spectra</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">())</span>
<span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nala_spectra_generated</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nala_spectra_generated</span><span class="p">[</span><span class="n">rand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nala_spectra</span><span class="p">[</span><span class="n">rand</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># removes 2pi shifts</span>
<span class="n">nala_params</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">nala_params</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize the learned embeddings</span>
<span class="n">embeddings</span><span class="p">(</span><span class="n">nala_params</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
           <span class="n">shape_</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize the actual RGB channels.</span>
<span class="n">embeddings</span><span class="p">(</span><span class="n">_nala_params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
           <span class="n">shape_</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><strong>results are much closer to the underlying physics since we enforced them</strong></p></li>
<li><p>The middle parameter is the phase. This is the hardest to learn <span class="math notranslate nohighlight">\(\rightarrow\)</span> this makes sense</p></li>
</ul>
</section>
</section>
<section id="try-with-a-better-optimizer-adahessian">
<h2>Try with a better optimizer AdaHessian<a class="headerlink" href="#try-with-a-better-optimizer-adahessian" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>There are better optimizers than ADAM that use second-order information</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Sun Feb 26 16:34:00 2021</span>
<span class="sd">@author: Amir Gholami</span>
<span class="sd">@coauthor: David Samuel</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">torch</span>


<span class="k">class</span> <span class="nc">AdaHessian</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Optimizer</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements the AdaHessian algorithm from &quot;ADAHESSIAN: An Adaptive Second OrderOptimizer for Machine Learning&quot;</span>
<span class="sd">    Arguments:</span>
<span class="sd">        params (iterable) -- iterable of parameters to optimize or dicts defining parameter groups</span>
<span class="sd">        lr (float, optional) -- learning rate (default: 0.1)</span>
<span class="sd">        betas ((float, float), optional) -- coefficients used for computing running averages of gradient and the squared hessian trace (default: (0.9, 0.999))</span>
<span class="sd">        eps (float, optional) -- term added to the denominator to improve numerical stability (default: 1e-8)</span>
<span class="sd">        weight_decay (float, optional) -- weight decay (L2 penalty) (default: 0.0)</span>
<span class="sd">        hessian_power (float, optional) -- exponent of the hessian trace (default: 1.0)</span>
<span class="sd">        update_each (int, optional) -- compute the hessian trace approximation only after *this* number of steps (to save time) (default: 1)</span>
<span class="sd">        n_samples (int, optional) -- how many times to sample `z` for the approximation of the hessian trace (default: 1)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">params</span><span class="p">,</span>
        <span class="n">lr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">betas</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">),</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">weight_decay</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">hessian_power</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">update_each</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">n_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">average_conv_kernel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">lr</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid learning rate: </span><span class="si">{</span><span class="n">lr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">eps</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid epsilon value: </span><span class="si">{</span><span class="n">eps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">betas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid beta parameter at index 0: </span><span class="si">{</span><span class="n">betas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">betas</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid beta parameter at index 1: </span><span class="si">{</span><span class="n">betas</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.0</span> <span class="o">&lt;=</span> <span class="n">hessian_power</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid Hessian power value: </span><span class="si">{</span><span class="n">hessian_power</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span> <span class="o">=</span> <span class="n">n_samples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_each</span> <span class="o">=</span> <span class="n">update_each</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">average_conv_kernel</span> <span class="o">=</span> <span class="n">average_conv_kernel</span>

        <span class="c1"># use a separate generator that deterministically generates the same `z`s across all GPUs in case of distributed training</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generator</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">()</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">2147483647</span><span class="p">)</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span>
            <span class="n">betas</span><span class="o">=</span><span class="n">betas</span><span class="p">,</span>
            <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
            <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span><span class="p">,</span>
            <span class="n">hessian_power</span><span class="o">=</span><span class="n">hessian_power</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AdaHessian</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">defaults</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">():</span>
            <span class="n">p</span><span class="o">.</span><span class="n">hess</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="s2">&quot;hessian step&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">get_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets all parameters in all param_groups with gradients</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">p</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_groups</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">requires_grad</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">zero_hessian</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Zeros out the accumulated hessian traces.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">hess</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="s2">&quot;hessian step&quot;</span><span class="p">]</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_each</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="p">):</span>
                <span class="n">p</span><span class="o">.</span><span class="n">hess</span><span class="o">.</span><span class="n">zero_</span><span class="p">()</span>

    <span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">set_hessian</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the Hutchinson approximation of the hessian trace and accumulates it for each trainable parameter.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_params</span><span class="p">()):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="s2">&quot;hessian step&quot;</span><span class="p">]</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_each</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="p">):</span>  <span class="c1"># compute the trace only for each `update_each` step</span>
                <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">p</span><span class="p">][</span><span class="s2">&quot;hessian step&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">device</span> <span class="o">!=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">device</span>
        <span class="p">):</span>  <span class="c1"># hackish way of casting the generator to the right device</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generator</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Generator</span><span class="p">(</span>
                <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">2147483647</span><span class="p">)</span>

        <span class="n">grads</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span><span class="p">):</span>
            <span class="n">zs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span>
                              <span class="n">generator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
                <span class="o">*</span> <span class="mf">2.0</span>
                <span class="o">-</span> <span class="mf">1.0</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span>
            <span class="p">]</span>  <span class="c1"># Rademacher distribution {-1.0, 1.0}</span>
            <span class="n">h_zs</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span>
                <span class="n">grads</span><span class="p">,</span>
                <span class="n">params</span><span class="p">,</span>
                <span class="n">grad_outputs</span><span class="o">=</span><span class="n">zs</span><span class="p">,</span>
                <span class="n">only_inputs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">retain_graph</span><span class="o">=</span><span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">h_z</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">h_zs</span><span class="p">,</span> <span class="n">zs</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
                <span class="n">p</span><span class="o">.</span><span class="n">hess</span> <span class="o">+=</span> <span class="p">(</span>
                    <span class="n">h_z</span> <span class="o">*</span> <span class="n">z</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_samples</span>
                <span class="p">)</span>  <span class="c1"># approximate the expected values of z*(H@z)</span>

    <span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">closure</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs a single optimization step.</span>
<span class="sd">        Arguments:</span>
<span class="sd">            closure (callable, optional) -- a closure that reevaluates the model and returns the loss (default: None)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">loss</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">closure</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">closure</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">zero_hessian</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_hessian</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_groups</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">grad</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">p</span><span class="o">.</span><span class="n">hess</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">average_conv_kernel</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">dim</span><span class="p">()</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">hess</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">hess</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">expand_as</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">hess</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">clone</span><span class="p">()</span>
                    <span class="p">)</span>

                <span class="c1"># Perform correct stepweight decay as in AdamW</span>
                <span class="n">p</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;lr&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;weight_decay&quot;</span><span class="p">])</span>

                <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>

                <span class="c1"># State initialization</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;exp_avg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span>
                        <span class="n">p</span><span class="o">.</span><span class="n">data</span>
                    <span class="p">)</span>  <span class="c1"># Exponential moving average of gradient values</span>
                    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;exp_hessian_diag_sq&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span>
                        <span class="n">p</span><span class="o">.</span><span class="n">data</span>
                    <span class="p">)</span>  <span class="c1"># Exponential moving average of Hessian diagonal square values</span>

                <span class="n">exp_avg</span><span class="p">,</span> <span class="n">exp_hessian_diag_sq</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;exp_avg&quot;</span><span class="p">],</span>
                    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;exp_hessian_diag_sq&quot;</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="n">beta1</span><span class="p">,</span> <span class="n">beta2</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;betas&quot;</span><span class="p">]</span>
                <span class="n">state</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># Decay the first and second moment running average coefficient</span>
                <span class="n">exp_avg</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="n">beta1</span><span class="p">)</span><span class="o">.</span><span class="n">add_</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">grad</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta1</span><span class="p">)</span>
                <span class="n">exp_hessian_diag_sq</span><span class="o">.</span><span class="n">mul_</span><span class="p">(</span><span class="n">beta2</span><span class="p">)</span><span class="o">.</span><span class="n">addcmul_</span><span class="p">(</span>
                    <span class="n">p</span><span class="o">.</span><span class="n">hess</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">hess</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span> <span class="n">beta2</span>
                <span class="p">)</span>

                <span class="n">bias_correction1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">beta1</span> <span class="o">**</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span>
                <span class="n">bias_correction2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">beta2</span> <span class="o">**</span> <span class="n">state</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span>

                <span class="n">k</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;hessian_power&quot;</span><span class="p">]</span>
                <span class="n">denom</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">exp_hessian_diag_sq</span> <span class="o">/</span> <span class="n">bias_correction2</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">pow_</span><span class="p">(</span><span class="n">k</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">add_</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s2">&quot;eps&quot;</span><span class="p">])</span>
                <span class="p">)</span>

                <span class="c1"># make update</span>
                <span class="n">step_size</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;lr&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">bias_correction1</span>
                <span class="n">p</span><span class="o">.</span><span class="n">addcdiv_</span><span class="p">(</span><span class="n">exp_avg</span><span class="p">,</span> <span class="n">denom</span><span class="p">,</span> <span class="n">value</span><span class="o">=-</span><span class="n">step_size</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">loss</span>
</pre></div>
</div>
</div>
</div>
<section id="id4">
<h3>Builds the model<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_vector</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">DensePhysLarger</span><span class="p">(</span>
    <span class="n">x_vector</span><span class="p">,</span> <span class="n">constructor</span><span class="p">,</span> <span class="n">dense_params</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">model_params</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">():</span>
    <span class="n">model</span><span class="o">.</span><span class="n">cuda</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id5">
<h3>Dataloader<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># builds the dataloader</span>

<span class="n">dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">spectra_full</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="id6">
<h3>Training<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">random_seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="n">loss_func</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>

<span class="c1"># Use AdaHessian</span>

<span class="n">optimizer</span> <span class="o">=</span> <span class="n">AdaHessian</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">epochs</span> <span class="o">=</span> <span class="mi">200</span>

<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">train_loss</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">total_num</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">train_batch</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>
        <span class="n">pred</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">train_batch</span><span class="o">.</span><span class="n">cuda</span><span class="p">())</span>

        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_func</span><span class="p">(</span><span class="n">train_batch</span><span class="o">.</span><span class="n">cuda</span><span class="p">(),</span> <span class="n">pred</span><span class="p">)</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">create_graph</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">train_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">*</span> <span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">total_num</span> <span class="o">+=</span> <span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

    <span class="n">train_loss</span> <span class="o">/=</span> <span class="n">total_num</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;epoch : </span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">, recon loss = </span><span class="si">{:.8f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">train_loss</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- </span><span class="si">%s</span><span class="s2"> seconds ---&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualization">
<h3>Visualization<a class="headerlink" href="#visualization" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spectra_generated</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">train_batch</span><span class="o">.</span><span class="n">cuda</span><span class="p">())</span>
<span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">272</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">spectra_generated</span><span class="p">[</span><span class="n">rand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_batch</span><span class="p">[</span><span class="n">rand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">rand</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nala_spectra_generated</span><span class="p">,</span> <span class="n">nala_params</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span>
    <span class="n">nala_spectra</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">cuda</span><span class="p">())</span>
<span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nala_spectra_generated</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nala_spectra_generated</span><span class="p">[</span><span class="n">rand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">nala_spectra</span><span class="p">[</span><span class="n">rand</span><span class="p">,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nala_params</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">nala_params</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualize the learned embeddings</span>
<span class="n">embeddings</span><span class="p">(</span><span class="n">nala_params</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span>
           <span class="n">shape_</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize the actual RGB channels.</span>
<span class="n">embeddings</span><span class="p">(</span><span class="n">_nala_params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
           <span class="n">shape_</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">1.25</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>This is clearly the best result</p>
<ul class="simple">
<li><p>It is quite impressive that we can build a feed forward model to fit data to complex functions</p></li>
<li><p>This is actually a very hard task for a neural network as frequency and phase are something that cannot be learned easily in convolutions</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Physics_Informed_Autoencoders"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports-packages">Imports Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-some-data-based-on-the-image">Generating some data based on the image</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-a-non-linear-function">Define a non-linear function</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-examples">Visualize examples</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recurrent-neural-network-autoencoders">Recurrent Neural Network Autoencoders</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#builds-the-autoencoder">Builds the autoencoder</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#builds-the-dataloader">Builds the dataloader</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-the-reconstruction">Visualize the reconstruction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-validation-data">Generating Validation Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#loads-and-image-of-my-dog-nala">Loads and image of my dog Nala</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#displays-the-image">Displays the image</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#generates-the-data-from-rgb-sampling">Generates the data from RGB sampling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-the-learned-results">Visualize the learned results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-try-a-bigger-model">Let’s try a bigger model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#builds-the-model">Builds the model</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#training">Training</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Visualize the reconstruction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Visualize the learned results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#physics-constrained-neural-network">Physics constrained neural network</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-the-model">Building the model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dataloader">Dataloader</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Training</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validation">Validation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#try-with-a-better-optimizer-adahessian">Try with a better optimizer AdaHessian</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Builds the model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Dataloader</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Training</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization">Visualization</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Yunseok	Kim, Rama	Vasudevan, Joshua	Agar, Ayana	Ghosh, Segei	Kalinin
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>